# Domain Plan Contribution: seo-minion

## Summary of Current State

After reviewing the full codebase of `da-schamdan` (a restaurant website on AEM Edge Delivery Services with Document Authoring), the SEO posture is minimal. The site relies almost entirely on EDS platform defaults for meta tags and indexing, with no custom SEO enhancements in the codebase. What follows is a detailed breakdown of findings and recommended audit dimensions.

### Key Files Reviewed

| File | SEO Relevance |
|------|--------------|
| `/Users/ben/github/benpeter/da-schamdan/head.html` | Only contains viewport, script/style refs, and a data-URI favicon placeholder. No meta description, no OG tags, no structured data, no canonical. |
| `/Users/ben/github/benpeter/da-schamdan/helix-query.yaml` | Defines site index with title (from og:title), description (from meta description), content, robots, lastModified. No image property indexed. |
| `/Users/ben/github/benpeter/da-schamdan/404.html` | Custom 404 with RUM tracking. No structured data. English text ("Page Not Found") despite `lang="de-DE"`. |
| `/Users/ben/github/benpeter/da-schamdan/scripts/scripts.js` | Sets `document.documentElement.lang = 'de-DE'`. Standard EDS loading pattern (eager/lazy/delayed). No structured data injection. |
| `/Users/ben/github/benpeter/da-schamdan/scripts/delayed.js` | CWV RUM collection. External links get `target="_blank" rel="noopener noreferrer"`. No analytics or tag manager integration. |
| `/Users/ben/github/benpeter/da-schamdan/scripts/aem.js` | Standard EDS aem.js with `createOptimizedPicture` (WebP support, lazy loading). `getMetadata` utility available but unused for SEO. |
| `/Users/ben/github/benpeter/da-schamdan/tools/sidekick/config.json` | Production host: `schamdan.de`. |
| `/Users/ben/github/benpeter/da-schamdan/blocks/header/header.js` | Fetches nav from `/nav.plain.html`. No `<nav>` landmark `aria-label`. No schema.org `SiteNavigationElement`. |
| `/Users/ben/github/benpeter/da-schamdan/blocks/speisen/speisen.js` | Restaurant menu block. No structured data (no `Menu`/`MenuItem` schema). Pure visual transformation. |
| `/Users/ben/github/benpeter/da-schamdan/fstab.yaml` | Content from DA (Document Authoring) at `content.da.live`. |
| `/Users/ben/github/benpeter/da-schamdan/styles/styles.css` | `body { display: none }` until `.appear` class added. No `font-display` declarations. System font stack (Palatino) with Roboto Mono as fixed font. |
| `/Users/ben/github/benpeter/da-schamdan/styles/fonts.css` | Empty (comment only: `/* load fonts */`). |

---

## Recommendations

### 1. What EDS Handles Automatically (Out of Codebase Control)

Understanding the EDS platform boundary is critical to avoid recommending work that is either unnecessary or impossible within the codebase:

- **robots.txt**: EDS auto-generates `robots.txt` at the CDN level. It is NOT served from the repo. The platform provides a default robots.txt for `*.aem.live` and `*.aem.page` domains that blocks crawling on preview/live origins and allows on production. There is no `robots.txt` to add to this repo.
- **XML Sitemap**: EDS auto-generates sitemaps from the query index (`/query-index.json`). The `helix-query.yaml` in the repo defines what pages go into the index, but the actual `/sitemap.xml` is generated by the platform. This is working as designed.
- **Canonical Tags**: EDS auto-generates `<link rel="canonical">` tags pointing to the production domain. No need to add them in `head.html`.
- **OG Tags / Twitter Cards**: EDS auto-populates `og:title`, `og:description`, `og:image`, `og:url`, `twitter:title`, `twitter:description`, `twitter:image` from the page's Metadata block in Document Authoring. The platform uses these special properties: `title`, `description`, `image` from the metadata table at the bottom of each DA document, and auto-populates all OG/Twitter variants.
- **Title Tag**: Auto-generated from the `title` metadata property or the first H1 on the page.
- **Image Optimization**: `createOptimizedPicture` in `aem.js` already generates WebP `<source>` elements with width-based srcset. Images are served through the EDS CDN with automatic optimization.

### 2. What IS Within Codebase Control and Needs Attention

#### 2.1 head.html -- Missing Site-Wide SEO Foundations (HIGH PRIORITY)

**Current state** (`/Users/ben/github/benpeter/da-schamdan/head.html`):
```html
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<script src="/scripts/aem.js" type="module"></script>
<script src="/scripts/scripts.js" type="module"></script>
<link rel="stylesheet" href="/styles/styles.css"/>
<link rel="icon" href="data:,">
```

**Issues**:
- **Favicon is a data-URI empty placeholder** (`data:,`). This prevents any favicon from appearing in browser tabs, bookmarks, and search results. Google shows favicons in mobile SERPs; a missing favicon reduces visual trust and click-through rate.
- **No site-wide structured data**. A restaurant website should have `Organization` and/or `Restaurant` (extends `FoodEstablishment`) schema in `head.html` since it applies to every page.
- **No `title:suffix` via bulk metadata**. Restaurant name should be appended to all page titles (e.g., "Speisekarte | Schamdan") for brand recognition in SERPs.

#### 2.2 Structured Data -- Completely Missing (HIGH PRIORITY)

This is the single largest SEO gap. For a restaurant website, the following schema types are directly eligible for Google rich results:

1. **Restaurant / FoodEstablishment** (extends LocalBusiness): Name, address, phone, opening hours, cuisine type, price range, menu URL, image, aggregate rating. This produces the Knowledge Panel and Local Pack entries in Google Search. For a restaurant, this is extremely high-value.

2. **Menu / MenuItem** (optional but valuable): The `speisen` block renders a full restaurant menu with item names, descriptions, and prices. This data could be exposed as `Menu` with `MenuItem` children, which helps Google understand the menu content for search features.

3. **WebSite** (with SearchAction if applicable): Standard site-level schema.

4. **BreadcrumbList**: If the site has navigation hierarchy (it appears relatively flat from the header block).

**Where to implement**:
- `Restaurant`/`Organization` schema: In `head.html` as JSON-LD (site-wide, identical on every page).
- `Menu`/`MenuItem` schema: Either in the `speisen.js` block (dynamically generated from the DOM after decoration) or via the Metadata block on the menu page in DA.

#### 2.3 Page-Level Metadata in Document Authoring (HIGH PRIORITY)

The EDS metadata system is powerful but only works if content authors actually populate the Metadata block at the bottom of each DA document. The audit should verify:

- Does each page in DA have a Metadata table with `title`, `description`, and `image` properties?
- Are the descriptions 150-160 characters, compelling, in German, with call-to-action?
- Are the images suitable for social sharing (1200x630)?
- Is there a `default-meta-image.png` at the content root? (Currently **missing** -- the platform falls back to this when no image is specified, and it does not exist.)

#### 2.4 helix-query.yaml -- Index Schema Gaps (MEDIUM PRIORITY)

**Current state** (`/Users/ben/github/benpeter/da-schamdan/helix-query.yaml`):
```yaml
properties:
  lastModified: ...
  title: select og:title
  description: select meta[name="description"]
  content: select main > div (textContent)
  robots: select meta[name="robots"]
```

**Issues**:
- **No `image` property indexed**. The query index powers the sitemap, and while EDS can work without it, having the image in the index enables image sitemaps and richer internal tooling.
- **No `path` property**. While EDS may add this automatically, explicitly indexing the path ensures reliable sitemap generation.
- **Excludes reasonable paths** (`/nav`, `/footer`, `/fragments/**`, etc.) which is correct.

#### 2.5 Favicon (MEDIUM PRIORITY)

The `<link rel="icon" href="data:,">` in `head.html` is an intentional placeholder to suppress the browser's default favicon request (a common EDS pattern to avoid 404s during development). For production:

- A real favicon should be added (`.ico` and/or `.svg` format).
- Apple touch icon (`<link rel="apple-touch-icon">`) should be added for iOS bookmarks.
- Google displays favicons in mobile search results. A branded favicon increases visual recognition and CTR.

#### 2.6 Language and Internationalization (MEDIUM PRIORITY)

- `lang="de-DE"` is set correctly in `scripts.js` via `document.documentElement.lang = 'de-DE'`.
- However, the 404 page uses **English text** ("Page Not Found", "Go home", "Go back"). For a German-language site targeting German users, this should be localized.
- No `hreflang` tags exist, but this is likely correct since the site appears to be single-language. If there is ever an English version, hreflang would be needed.

#### 2.7 Semantic HTML and Heading Structure (MEDIUM PRIORITY)

- The `<nav>` element in `header.js` is correct semantic HTML, but lacks `aria-label="Hauptnavigation"` for accessibility and crawler comprehension.
- The `<header>`, `<main>`, `<footer>` structure is used on the 404 page and presumably on content pages (standard EDS pattern). This is correct.
- Hero block extracts H1 and picture into a hero section. Need to verify that each content page has exactly one H1 and that the heading hierarchy is logical.
- The speisen block uses no semantic heading hierarchy internally -- it creates `div` elements with class names. Menu section headings in DA content should use proper H2/H3 tags.

#### 2.8 Core Web Vitals Considerations (MEDIUM PRIORITY)

Items within codebase control that affect CWV as ranking signals:

- **`body { display: none }` until `.appear`**: This is standard EDS anti-FOUC pattern. The `appear` class is added early in `loadEager()`, so it should not significantly impact LCP. However, if the first section loads slowly, LCP could be delayed.
- **Font loading strategy**: `fonts.css` is empty. The body font stack is `Palatino, Times, Times New Roman, serif` (system fonts), so there should be no web font CLS issues. `Roboto Mono` is referenced as `--fixed-font-family` but only used on the 404 page's SVG text. No `font-display` declaration exists because no web fonts are loaded. This is actually good for CWV.
- **Image dimensions**: `main img { max-width: 100%; width: auto; height: auto; }` does not set explicit dimensions, which could cause CLS. However, EDS's `createOptimizedPicture` generates `<picture>` elements, and the hero block uses `object-fit: cover` with absolute positioning. CLS risk exists for non-hero images if `width` and `height` attributes are not set on `<img>` tags in DA content.
- **Lazy loading**: `createOptimizedPicture` defaults to `loading="lazy"`, with the first image in the first section switched to `loading="eager"` by `waitForFirstImage()`. This is correct.
- **Delayed JS**: `delayed.js` loads after a 3-second timeout, which is good -- it defers CWV RUM collection and external link processing.

#### 2.9 External Link Handling (LOW PRIORITY)

`delayed.js` correctly adds `target="_blank" rel="noopener noreferrer"` to external links. The `noopener` prevents `window.opener` exploits and `noreferrer` prevents referrer leaking. Some SEO practitioners prefer `rel="noopener"` without `noreferrer` to allow referrer data to flow to linked sites (potential for reciprocal links). This is a minor consideration.

#### 2.10 Content Discoverability from DA (LOW PRIORITY but IMPORTANT FOR AUDIT)

Since content lives in Document Authoring (not in the repo), the audit cannot verify:
- Whether each page has proper H1 tags
- Whether metadata tables exist with title/description/image
- Whether images have alt text
- Whether internal links use descriptive anchor text

These must be checked via the live site or the DA authoring interface.

---

## Proposed Tasks

### Task 1: Add Restaurant Structured Data to head.html (HIGH)

**What to do**: Create a JSON-LD `<script type="application/ld+json">` block in `/Users/ben/github/benpeter/da-schamdan/head.html` with `Restaurant` schema (extends `FoodEstablishment` which extends `LocalBusiness`).

**Required properties**: `@type`, `name`, `address` (PostalAddress), `telephone`, `url`, `image`, `servesCuisine`, `priceRange`, `openingHoursSpecification`.

**Recommended properties**: `menu` (URL to Speisekarte page), `geo` (latitude/longitude), `aggregateRating` (if reviews exist), `sameAs` (social profiles), `hasMap` (Google Maps link).

**Deliverables**:
- Complete JSON-LD block ready for `head.html`
- Validation results from Schema Markup Validator and Rich Results Test
- Documentation of which properties need values from the restaurant owner

**Dependencies**: Need actual restaurant data (address, phone number, opening hours, cuisine type). This must be sourced from the restaurant owner or the existing content.

### Task 2: Add Menu Structured Data to speisen Block (HIGH)

**What to do**: Enhance `/Users/ben/github/benpeter/da-schamdan/blocks/speisen/speisen.js` to dynamically generate `Menu` and `MenuItem` JSON-LD from the decorated DOM.

**Approach**: After the block decoration completes, read the `.item-info`, `.item-prices`, and `.item-desc` elements to build structured data. Inject a `<script type="application/ld+json">` into the document head.

**Deliverables**:
- Updated `speisen.js` with JSON-LD generation function
- Schema specification with sample output
- Validation approach documentation

**Dependencies**: Task 1 (the Menu schema should reference the Restaurant entity via `@id`).

### Task 3: Create default-meta-image.png (HIGH)

**What to do**: Create a `/default-meta-image.png` in the DA content root. This is the fallback image EDS uses for `og:image` when no page-specific image is set. Without it, pages without images will have no social preview image.

**Deliverables**:
- A branded 1200x630 image suitable for social sharing
- Placed in the DA content root (not in the code repo -- this is a content asset)

**Dependencies**: Need restaurant branding/logo/photo assets.

### Task 4: Replace Favicon Placeholder (MEDIUM)

**What to do**: Replace `<link rel="icon" href="data:,">` in `/Users/ben/github/benpeter/da-schamdan/head.html` with a real favicon.

**Deliverables**:
- `/icons/favicon.ico` (or `.svg`) added to the repo
- `<link rel="icon">` updated in head.html
- `<link rel="apple-touch-icon">` added for iOS
- Optional: `<link rel="icon" type="image/svg+xml">` for modern browsers

**Dependencies**: Need restaurant logo/brand assets for favicon creation.

### Task 5: Add image Property to helix-query.yaml (MEDIUM)

**What to do**: Add an `image` property to `/Users/ben/github/benpeter/da-schamdan/helix-query.yaml` to index the og:image for each page.

```yaml
image:
  select: head > meta[property="og:image"]
  value: attribute(el, "content")
```

**Deliverables**: Updated `helix-query.yaml` with image property.

**Dependencies**: None.

### Task 6: Localize 404 Page to German (MEDIUM)

**What to do**: Translate the 404 page content in `/Users/ben/github/benpeter/da-schamdan/404.html` from English to German.

- "Page Not Found" -> "Seite nicht gefunden"
- "Go home" -> "Zur Startseite"
- "Go back" -> "Zuruck"

**Deliverables**: Updated `404.html` with German text while keeping the `<title>` as "404" or "Seite nicht gefunden" and adding `lang="de-DE"` to the `<html>` tag.

**Dependencies**: None.

### Task 7: Verify DA Content Metadata (MEDIUM -- Audit Only)

**What to do**: Check the live site (schamdan.de) or DA authoring interface for each published page to verify:
- Metadata table exists at bottom of each document
- `title` property set (or H1 is sufficient)
- `description` property set (150-160 chars, German, compelling)
- `image` property set (1200x630 social image)
- Each page has exactly one H1
- Heading hierarchy is logical (no skipped levels)
- Images have descriptive alt text
- Internal links use descriptive anchor text (not "hier klicken")

**Deliverables**: Page-by-page metadata audit table with status and recommendations.

**Dependencies**: Access to DA authoring interface or the live site.

### Task 8: Add title:suffix via Bulk Metadata (LOW)

**What to do**: Set up a bulk metadata sheet in DA to apply `title:suffix: | Schamdan` (or appropriate restaurant name) across all pages. This ensures brand recognition in SERPs without requiring each page to manually include the brand in its title.

**Deliverables**: Bulk metadata configuration specification.

**Dependencies**: Confirm restaurant brand name and preferred format.

### Task 9: Audit Live Site Rendering for SEO (LOW -- Validation)

**What to do**: After all changes are implemented, validate the live site:
- Google Rich Results Test on homepage and menu page
- Schema Markup Validator on all pages with structured data
- Google PageSpeed Insights for CWV field/lab data
- Mobile-friendliness check
- Social preview check (Facebook Debugger, Twitter Card Validator)
- Check rendered HTML in Google Search Console URL Inspection

**Deliverables**: Validation report with screenshots and pass/fail status.

**Dependencies**: All implementation tasks completed and deployed.

---

## Risks and Concerns

### 1. Content is in DA, Not in the Repo
The biggest risk is that critical SEO elements (titles, descriptions, H1 tags, image alt text) live in Document Authoring content, not in the codebase. The code review can identify what the platform supports and what is missing from the template/infrastructure, but cannot verify whether content authors are using the metadata system correctly. A separate content audit is needed.

### 2. Restaurant Data Availability
Structured data for `Restaurant`/`LocalBusiness` requires specific factual data (address, phone, hours, cuisine type, coordinates). If this data is not readily available or is inaccurate, the structured data will be incomplete or harmful. Google penalizes inaccurate LocalBusiness data.

### 3. Menu Structured Data Maintenance
Dynamically generating `Menu`/`MenuItem` schema from the speisen block DOM is elegant but fragile. If the content model changes (different column structure, new price formats), the JSON-LD generation could produce invalid output. Robust error handling and validation are needed.

### 4. EDS Platform Behavior Assumptions
Several recommendations assume standard EDS behavior (auto-generated robots.txt, sitemap from query-index, canonical tags, OG tag population from metadata). If the DA+EDS combination behaves differently from the standard Google Drive/SharePoint + EDS setup, some assumptions may be wrong. The live site should be checked to confirm these platform behaviors are active.

### 5. No Google Search Console Access
Without GSC data, we cannot assess current indexing status, crawl errors, CWV field data, or existing search performance. The audit is limited to code-level analysis and live site inspection.

### 6. body display:none Pattern
The `body { display: none }` CSS with JavaScript-toggled `.appear` class is standard EDS, but if JavaScript fails to load or execute, the entire page is invisible. This is a rendering risk for crawlers that do not execute JavaScript, though Google's crawler does execute JS. Bing and other crawlers may have issues.

### 7. dapreview.js Dynamic Import
`scripts.js` unconditionally imports `dapreview.js` which conditionally imports from `https://da.live`. On production (without `?dapreview` parameter), this resolves to `undefined` and should not impact SEO. However, the dynamic import adds a module to the dependency chain that is evaluated on every page load. Worth verifying it does not affect LCP timing.

---

## Additional Agents Needed

### accessibility-minion
The header block's `<nav>` element lacks `aria-label`. The 404 page uses an SVG for the "404" text which may not be accessible. While these are primarily accessibility concerns, they overlap with SEO because screen reader navigation landmarks help search engines understand page structure. The accessibility agent should review the header, navigation, and all interactive elements.

### sitespeed-minion
While I have flagged CWV-relevant items (body display:none, font loading, image dimensions, lazy loading), a dedicated performance review should examine:
- Whether the eager/lazy loading split is optimal for LCP
- Whether the 3-second delayed.js timeout is appropriate
- Whether CSS is render-blocking unnecessarily
- The impact of the dapreview.js dynamic import on page load
- Overall performance budget for the site

These are not SEO concerns per se, but CWV is a ranking signal and poor performance in the field will impact rankings.

### No other agents needed beyond what is described above. The frontend agent will be needed for implementation of the structured data recommendations, but that is an execution concern, not a planning concern.
